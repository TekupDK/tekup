# üîß Fix: GOOGLE_PRIVATE_KEY Format Issue\n\n\n\n## ‚ùå Problem Identificeret\n\n\n\n**Error fra Render logs:**\n\n```json{  "level":50,  "error":{    "library":"DECODER routines",    "reason":"unsupported",    "code":"ERR_OSSL_UNSUPPORTED"  },  "msg":"Failed to process lead"}\n\n```**Root Cause:** `GOOGLE_PRIVATE_KEY` environment variable er **forkert formateret** p√• Render. OpenSSL kan ikke decode private key.\n\n\n\n## ‚úÖ Korrekt Format\n\n\n\nDin private key skal v√¶re formatted **PR√ÜCIS s√•dan**:\n\n```-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...\n...\n-----END PRIVATE KEY-----\n\n\n```**Vigtigt:**\n\n- ‚úÖ `\n` bruges for newlines (NOT faktiske newlines)\n\n- ‚úÖ HELE key string skal v√¶re p√• √âN linje\n\n- ‚úÖ Ingen quotes omkring v√¶rdi (eller kun ydre quotes)\n\n- ‚úÖ Ingen ekstra backslashes (`\\n` er forkert, skal v√¶re `\n`)\n\n\n\n## üöÄ Fix Steps\n\n\n\n### Step 1: Hent korrekt key fra lokal .env\n\n\n\n```powershell\n\n# PowerShell - Read local key\n\n$envContent = Get-Content ".env" -Raw\n\nif ($envContent -match 'GOOGLE_PRIVATE_KEY="(-----BEGIN PRIVATE KEY-----.*?-----END PRIVATE KEY-----)"') {\n\n    $key = $matches[1]    Write-Host "‚úÖ Key found, copy this to clipboard:" -ForegroundColor Green    $key | Set-Clipboard    Write-Host "Key copied to clipboard!" -ForegroundColor Cyan} else {    Write-Host "‚ùå Key not found in .env" -ForegroundColor Red}\n\n```\n\n### Step 2: Opdater Render Environment Variable\n\n\n\n1. G√• til: <https://dashboard.render.com/web/srv-d3dv61ffte5s73f1uccg/env>\n\n2. Find: **GOOGLE_PRIVATE_KEY**\n\n3. Klik **Edit**\n\n4. **VIGTIGT:** Paste den FULDE key value (inklusive `-----BEGIN` og `-----END`)\n\n5. **Format check:**- Skal v√¶re √âN lang linje\n\n   - Skal have `\n` characters (ikke faktiske newlines)\n\n   - Skal starte med `-----BEGIN PRIVATE KEY-----\n`\n\n   - Skal slutte med `\n-----END PRIVATE KEY-----\n`\n\n6. Klik **Save**\n\n7. **RESTART SERVICE** (ikke rebuild - kun restart!)\n\n\n\n### Step 3: Verify Fix\n\n\n\nEfter restart (30 sekunder), test endpoint:\n\n```powershell$body = @{emailBody="Test fra kontakt@firma.dk"} | ConvertTo-JsonInvoke-RestMethod -Uri "https://tekup-renos.onrender.com/api/leads/process" `  -Method Post -Body $body -ContentType "application/json"\n\n```**Expected:**\n\n- ‚úÖ Returns 200 OK (ikke 500)\n\n- ‚úÖ Logs viser IKKE "ERR_OSSL_UNSUPPORTED"\n\n- ‚úÖ Response contains parsed lead data\n\n\n\n## üîç Alternative Fix: Use Base64 Encoded Key\n\n\n\nHvis ovenst√•ende ikke virker, encode key som base64:\n\n```powershell\n\n# Encode key\n\n$key = (Get-Content ".env" | Select-String "GOOGLE_PRIVATE_KEY").ToString()\n\n$key = $key -replace 'GOOGLE_PRIVATE_KEY="(.*)"', '$1'$bytes = [System.Text.Encoding]::UTF8.GetBytes($key)$base64 = [Convert]::ToBase64String($bytes)Write-Host "Base64 encoded key:"Write-Host $base64\n\n```Derefter opdater backend kode til at decode:\n\n```typescript// src/config.tsconst privateKey = process.env.GOOGLE_PRIVATE_KEY_BASE64  ? Buffer.from(process.env.GOOGLE_PRIVATE_KEY_BASE64, 'base64').toString('utf-8')  : process.env.GOOGLE_PRIVATE_KEY;\n\n```\n\n## üìä Common Mistakes\n\n\n\n| ‚ùå Forkert | ‚úÖ Korrekt ||-----------|----------|| `\\n` (double backslash) | `\n` (single backslash) || Multi-line v√¶rdi | Single-line v√¶rdi || Mangler `-----BEGIN`/`-----END` | Inkluderer headers || Har ekstra spaces | Ingen spaces || Har quotes inden i value | Kun ydre quotes (eller ingen) |\n\n## üéØ Quick Verification Checklist\n\n\n\nEfter Render opdatering:\n\n- [ ] Environment variable saved\n\n- [ ] Service restarted (NOT rebuild)\n\n- [ ] Test `/api/leads/process` - returns 200\n\n- [ ] Check logs - NO "ERR_OSSL_UNSUPPORTED" errors\n\n- [ ] Gmail API calls working\n\n- [ ] Calendar API calls working\n\n---**Priority:** üî¥ CRITICAL - Blocker for all AI features**ETA:** 5 min (just restart service, no rebuild needed)**Impact:** Fixes both Gmail + Calendar API issues