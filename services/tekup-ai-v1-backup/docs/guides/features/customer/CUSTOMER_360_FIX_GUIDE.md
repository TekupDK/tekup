# Customer 360 Email Threads - Quick Fix Guide\n\n\n\n## ğŸš¨ Problem\n\nCustomer 360 viser ingen email trÃ¥de fordi email ingest endnu ikke er kÃ¸rt.\n\n\n\n## âœ… Status\n\n- âœ… Database tabeller oprettet i Neon (email_threads, email_messages, email_ingest_runs)\n\n- âœ… Backend deployet til Render.com\n\n- âœ… Trust proxy og favicon handler tilfÃ¸jet\n\n\n\n## ğŸ”§ LÃ¸sning (2 Steps)\n\n\n\n### Step 1: Warm Up Server\n\nÃ…bn i browser (warm up cold-start):\n\n```\n\nhttps://tekup-renos.onrender.com/health\n\n```**Forventet resultat:**\n\n```json{"status":"ok","timestamp":"..."}\n\n```\n\n### Step 2: KÃ¸r Email Ingest\n\n\n\n#### âš ï¸ VIGTIGT: Brug den KORREKTE URL\n\n```\n\nhttps://tekup-renos.onrender.com/api/dashboard/email-ingest/stats\n\n```**ELLER hvis du bruger det andet service:**\n\n```https://tekup-renos-1.onrender.com/api/dashboard/email-ingest/stats\n\n```**Forventet resultat:**\n\n```json{  "latestRun": { "status": "completed", "totalEmails": 150, ... },  "totalThreads": 150,  "matchedThreads": 120,  "unmatchedThreads": 30}\n\n```\n\n### Step 3: Verificer i UI\n\n1. GÃ¥ til Customer 360\n\n2. VÃ¦lg en kunde\n\n3. Du skulle nu se deres email trÃ¥de! ğŸ‰\n\n## ğŸ” Hvis Ingen TrÃ¥de Vises\n\n\n\n### Check 1: RUN_MODE Environment Variable\n\nEmail ingest kÃ¸rer kun i `production` mode, ikke `dry-run`.\n\n**Fix i Render Dashboard:**\n\n1. GÃ¥ til <https://dashboard.render.com>\n\n2. Find "tekup-renos" service\n\n3. Klik "Environment" tab\n\n4. Find `RUN_MODE` variabel\n\n5. SÃ¦t vÃ¦rdi til: `production`\n\n6. Klik "Save Changes"\n\n7. Tjen vil auto-redeploy\n\n### Check 2: Gmail Credentials\n\nVerify at disse environment variables er sat i Render:\n\n- `GOOGLE_PROJECT_ID`\n\n- `GOOGLE_CLIENT_EMAIL`\n\n- `GOOGLE_PRIVATE_KEY` (korrekt formateret med `\n` for newlines)\n\n- `GOOGLE_IMPERSONATED_USER` (fx `info@rendetalje.dk`)\n\n\n\n### Check 3: Database Connection\n\nKÃ¸r i Neon SQL Editor:\n\n```sql-- Check om data blev indlÃ¦st\n\nSELECT COUNT(_) FROM email_threads;SELECT COUNT(_) FROM email_messages;-- Se seneste ingest runs\n\nSELECT * FROM email_ingest_runs ORDER BY "startedAt" DESC LIMIT 5;\n\n-- Se seneste trÃ¥de\n\nSELECT "subject", "lastMessageAt", "messageCount"FROM email_threadsORDER BY "lastMessageAt" DESCLIMIT 10;\n\n```\n\n## ğŸ¯ Forventede Resultater\n\n\n\nEfter vellykket ingest:\n\n- âœ… 100+ email threads i database\n\n- âœ… Customer 360 viser trÃ¥de for kunder\n\n- âœ… Klik pÃ¥ trÃ¥d viser beskeder\n\n- âœ… Reply funktion virker\n\n- âœ… Smart matching har linket trÃ¥de til kunder\n\n\n\n## ğŸ› Troubleshooting\n\n\n\n### Error: "Property 'emailThread' does not exist on type 'PrismaClient'"\n\n**LÃ¸sning:** KÃ¸r `npx prisma generate` lokalt og redeploy.\n\n\n\n### Error: "Bad Gateway" eller 502\n\n**LÃ¸sning:**\n\n1. Server er i cold-start, prÃ¸v igen efter 30 sekunder\n\n2. Hit `/health` endpoint fÃ¸rst\n\n3. Check Render logs for errors\n\n### Error: "X-Forwarded-For header is set but 'trust proxy' is false"\n\n**LÃ¸sning:** Allerede fixet med `app.set('trust proxy', 1)` i denne commit.\n\n\n\n### Ingen Gmail data hentes\n\n**LÃ¸sning:**\n\n1. Verify `RUN_MODE=production` (ikke `dry-run`)\n\n2. Check Gmail credentials er korrekte\n\n3. Verify service account har domain-wide delegation\n\n## ğŸ“Š Success Metrics\n\n\n\nNÃ¥r alt virker:\n\n- Backend health check: 200 OK\n\n- Email ingest stats: `{"totalThreads": 100+}`\n\n- Customer 360 UI: Viser trÃ¥de for kunder\n\n- Database: `email_threads` og `email_messages` tabeller har data\n\n\n\n## ğŸš€ NÃ¦ste Gang\n\n\n\nFor at holde data synkroniseret, kÃ¸r periodisk:\n\n```bashcurl https://tekup-renos.onrender.com/api/dashboard/email-ingest/stats\n\n```Eller setup en cron job (fremtidigt feature).