# Development Dockerfile for API service
FROM node:20-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Install pnpm globally
RUN npm i -g pnpm@9

# Copy package files for dependency installation
COPY package.json pnpm-lock.yaml ./
COPY pnpm-workspace.yaml ./
COPY apps/flow-api/package.json ./apps/flow-api/

# Install all dependencies (including dev dependencies for hot reload)
RUN pnpm install

# Copy source files
COPY apps/flow-api ./apps/flow-api

# Set working directory to API
WORKDIR /app/apps/flow-api

# Generate Prisma client
RUN pnpm prisma generate

EXPOSE 4000

# Use development command with hot reload
CMD ["pnpm", "dev"]
