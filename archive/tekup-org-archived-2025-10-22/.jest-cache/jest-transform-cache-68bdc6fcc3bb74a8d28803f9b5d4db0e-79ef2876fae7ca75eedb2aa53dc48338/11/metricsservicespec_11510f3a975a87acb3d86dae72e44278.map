{"version":3,"sources":["C:\\Users\\empir\\Tekup-org\\apps\\flow-api\\src\\metrics\\metrics.service.spec.ts"],"sourcesContent":["import { MetricsService } from './metrics.service.js';\r\n\r\ndescribe('MetricsService', () => {\r\n  it('increments generic counters and renders prometheus text', () => {\r\n    const svc = new MetricsService();\r\n    svc.increment('lead_created_total', { tenant: 'tenantA', source: 'form' });\r\n    svc.increment('lead_created_total', { tenant: 'tenantA', source: 'form' });\r\n    svc.increment('lead_status_transition_total', { tenant: 'tenantA', from: 'NEW', to: 'CONTACTED' });\r\n    const text = svc.renderPrometheus();\r\n    expect(text).toContain('lead_created_total');\r\n    expect(text).toContain('tenant=\"tenantA\"');\r\n  const lines = text.split(/\\n+/);\r\n  const createdLine = lines.find(l => l.startsWith('lead_created_total'))!;\r\n  expect(createdLine).toMatch(/lead_created_total\\{/);\r\n  expect(createdLine).toContain('tenant=\"tenantA\"');\r\n  expect(createdLine).toContain('source=\"form\"');\r\n  expect(createdLine.endsWith(' 2')).toBe(true);\r\n  const transitionLine = lines.find(l => l.startsWith('lead_status_transition_total'))!;\r\n  expect(transitionLine).toContain('from=\"NEW\"');\r\n  expect(transitionLine).toContain('to=\"CONTACTED\"');\r\n  expect(transitionLine).toContain('tenant=\"tenantA\"');\r\n  expect(transitionLine.endsWith(' 1')).toBe(true);\r\n  });\r\n});\r\n"],"names":["describe","it","svc","MetricsService","increment","tenant","source","from","to","text","renderPrometheus","expect","toContain","lines","split","createdLine","find","l","startsWith","toMatch","endsWith","toBe","transitionLine"],"mappings":";;;;gCAA+B;AAE/BA,SAAS,kBAAkB;IACzBC,GAAG,2DAA2D;QAC5D,MAAMC,MAAM,IAAIC,8BAAc;QAC9BD,IAAIE,SAAS,CAAC,sBAAsB;YAAEC,QAAQ;YAAWC,QAAQ;QAAO;QACxEJ,IAAIE,SAAS,CAAC,sBAAsB;YAAEC,QAAQ;YAAWC,QAAQ;QAAO;QACxEJ,IAAIE,SAAS,CAAC,gCAAgC;YAAEC,QAAQ;YAAWE,MAAM;YAAOC,IAAI;QAAY;QAChG,MAAMC,OAAOP,IAAIQ,gBAAgB;QACjCC,OAAOF,MAAMG,SAAS,CAAC;QACvBD,OAAOF,MAAMG,SAAS,CAAC;QACzB,MAAMC,QAAQJ,KAAKK,KAAK,CAAC;QACzB,MAAMC,cAAcF,MAAMG,IAAI,CAACC,CAAAA,IAAKA,EAAEC,UAAU,CAAC;QACjDP,OAAOI,aAAaI,OAAO,CAAC;QAC5BR,OAAOI,aAAaH,SAAS,CAAC;QAC9BD,OAAOI,aAAaH,SAAS,CAAC;QAC9BD,OAAOI,YAAYK,QAAQ,CAAC,OAAOC,IAAI,CAAC;QACxC,MAAMC,iBAAiBT,MAAMG,IAAI,CAACC,CAAAA,IAAKA,EAAEC,UAAU,CAAC;QACpDP,OAAOW,gBAAgBV,SAAS,CAAC;QACjCD,OAAOW,gBAAgBV,SAAS,CAAC;QACjCD,OAAOW,gBAAgBV,SAAS,CAAC;QACjCD,OAAOW,eAAeF,QAAQ,CAAC,OAAOC,IAAI,CAAC;IAC3C;AACF"}