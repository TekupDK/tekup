{"version":3,"sources":["C:\\Users\\empir\\Tekup-org\\apps\\flow-api\\src\\ingestion\\parsers\\leadmail.ts"],"sourcesContent":["import { RawEmailInput, ParseResult, ParsedLeadPayload } from '../types.js';\r\nimport { finalizePayload } from '../normalize.js';\r\n\r\nexport function parseLeadmail(input: RawEmailInput): ParseResult | undefined {\r\n  const text = input.rawText;\r\n  if (!/leadmail|rengøring\\.nu/i.test(text) && !/kontakt@leadmail\\.no/i.test(input.from)) return undefined;\r\n\r\n  const payload: ParsedLeadPayload = {\r\n    brand: 'rendetalje',\r\n    source: 'leadmail',\r\n    name: capture(text, /navn:\\s*(.+)/i),\r\n    phone: capture(text, /telefon(?:nummer)?:\\s*([+0-9 ()-]{6,})/i),\r\n    email: capture(text, /e-?post|e-?mail:?\\s*([\\w.+-]+@[\\w.-]+)/i),\r\n    address: capture(text, /adresse:\\s*(.+)/i),\r\n    postal_code: capture(text, /postnr:\\s*(\\d{4})/i),\r\n    city: capture(text, /by:\\s*([A-Za-zÆØÅæøå .-]+)/i),\r\n    service_type: capture(text, /(privat|erhverv|flyt|kontor|vindues)/i),\r\n    frequency: capture(text, /(ugentlig|månedlig|hver 14\\.? ?dag|engangs)/i) || undefined,\r\n    notes: undefined\r\n  };\r\n\r\n  const found = Object.values(payload).filter(v => v !== undefined && v !== null).length;\r\n  const confidence = Math.min(1, found / 8);\r\n  return { payload: finalizePayload(payload), confidence };\r\n}\r\n\r\nfunction capture(text: string, regex: RegExp): string | undefined {\r\n  const m = text.match(regex);\r\n  if (!m) return undefined;\r\n  return m[m.length - 1].trim();\r\n}\r\n"],"names":["parseLeadmail","input","text","rawText","test","from","undefined","payload","brand","source","name","capture","phone","email","address","postal_code","city","service_type","frequency","notes","found","Object","values","filter","v","length","confidence","Math","min","finalizePayload","regex","m","match","trim"],"mappings":";;;;+BAGgBA;;;eAAAA;;;2BAFgB;AAEzB,SAASA,cAAcC,KAAoB;IAChD,MAAMC,OAAOD,MAAME,OAAO;IAC1B,IAAI,CAAC,0BAA0BC,IAAI,CAACF,SAAS,CAAC,wBAAwBE,IAAI,CAACH,MAAMI,IAAI,GAAG,OAAOC;IAE/F,MAAMC,UAA6B;QACjCC,OAAO;QACPC,QAAQ;QACRC,MAAMC,QAAQT,MAAM;QACpBU,OAAOD,QAAQT,MAAM;QACrBW,OAAOF,QAAQT,MAAM;QACrBY,SAASH,QAAQT,MAAM;QACvBa,aAAaJ,QAAQT,MAAM;QAC3Bc,MAAML,QAAQT,MAAM;QACpBe,cAAcN,QAAQT,MAAM;QAC5BgB,WAAWP,QAAQT,MAAM,mDAAmDI;QAC5Ea,OAAOb;IACT;IAEA,MAAMc,QAAQC,OAAOC,MAAM,CAACf,SAASgB,MAAM,CAACC,CAAAA,IAAKA,MAAMlB,aAAakB,MAAM,MAAMC,MAAM;IACtF,MAAMC,aAAaC,KAAKC,GAAG,CAAC,GAAGR,QAAQ;IACvC,OAAO;QAAEb,SAASsB,IAAAA,0BAAe,EAACtB;QAAUmB;IAAW;AACzD;AAEA,SAASf,QAAQT,IAAY,EAAE4B,KAAa;IAC1C,MAAMC,IAAI7B,KAAK8B,KAAK,CAACF;IACrB,IAAI,CAACC,GAAG,OAAOzB;IACf,OAAOyB,CAAC,CAACA,EAAEN,MAAM,GAAG,EAAE,CAACQ,IAAI;AAC7B"}