{"version":3,"sources":["C:\\Users\\empir\\Tekup-org\\apps\\flow-api\\src\\ingestion\\parser.spec.ts"],"sourcesContent":["import { runParsers } from './parser.js';\r\nimport { RawEmailInput } from './types.js';\r\n\r\ndescribe('runParsers', () => {\r\n  it('parses leadpoint style email', () => {\r\n    const input: RawEmailInput = {\r\n      mailbox: 'leads@rendetalje.dk',\r\n      subject: 'Nyt rengøringslead',\r\n      from: 'notify@leadpoint.io',\r\n      rawText: 'Navn: Test Person\\nTelefon: +4511223344\\nE-mail: test@example.com\\nAdresse: Gade 1\\nOpgave: Kontorrengøring 120 m2'\r\n    };\r\n    const r = runParsers(input)!;\r\n    expect(r).toBeTruthy();\r\n    expect(r.payload.source).toBe('leadpoint');\r\n    expect(r.payload.email).toBe('test@example.com');\r\n    expect(r.confidence).toBeGreaterThan(0);\r\n    expect(r.confidence).toBeLessThanOrEqual(1);\r\n  });\r\n\r\n  it('parses leadmail style email', () => {\r\n    const input: RawEmailInput = {\r\n      mailbox: 'leads@rendetalje.dk',\r\n      subject: 'Rengøring.nu forespørgsel',\r\n      from: 'kontakt@leadmail.no',\r\n      rawText: 'Navn: Firma A\\nTelefon: 12345678\\nE-mail: firma@example.com\\nAdresse: Vej 2\\nPostnr: 2100\\nBy: København'\r\n    };\r\n    const r = runParsers(input)!;\r\n    expect(r.payload.source).toBe('leadmail');\r\n    expect(r.payload.postal_code).toBe('2100');\r\n  });\r\n\r\n  it('returns undefined for unrelated email', () => {\r\n    const input: RawEmailInput = {\r\n      mailbox: 'support@rendetalje.dk',\r\n      subject: 'Question',\r\n      from: 'user@example.com',\r\n      rawText: 'Hello just saying hi'\r\n    };\r\n    const r = runParsers(input);\r\n    expect(r).toBeUndefined();\r\n  });\r\n});"],"names":["describe","it","input","mailbox","subject","from","rawText","r","runParsers","expect","toBeTruthy","payload","source","toBe","email","confidence","toBeGreaterThan","toBeLessThanOrEqual","postal_code","toBeUndefined"],"mappings":";;;;wBAA2B;AAG3BA,SAAS,cAAc;IACrBC,GAAG,gCAAgC;QACjC,MAAMC,QAAuB;YAC3BC,SAAS;YACTC,SAAS;YACTC,MAAM;YACNC,SAAS;QACX;QACA,MAAMC,IAAIC,IAAAA,kBAAU,EAACN;QACrBO,OAAOF,GAAGG,UAAU;QACpBD,OAAOF,EAAEI,OAAO,CAACC,MAAM,EAAEC,IAAI,CAAC;QAC9BJ,OAAOF,EAAEI,OAAO,CAACG,KAAK,EAAED,IAAI,CAAC;QAC7BJ,OAAOF,EAAEQ,UAAU,EAAEC,eAAe,CAAC;QACrCP,OAAOF,EAAEQ,UAAU,EAAEE,mBAAmB,CAAC;IAC3C;IAEAhB,GAAG,+BAA+B;QAChC,MAAMC,QAAuB;YAC3BC,SAAS;YACTC,SAAS;YACTC,MAAM;YACNC,SAAS;QACX;QACA,MAAMC,IAAIC,IAAAA,kBAAU,EAACN;QACrBO,OAAOF,EAAEI,OAAO,CAACC,MAAM,EAAEC,IAAI,CAAC;QAC9BJ,OAAOF,EAAEI,OAAO,CAACO,WAAW,EAAEL,IAAI,CAAC;IACrC;IAEAZ,GAAG,yCAAyC;QAC1C,MAAMC,QAAuB;YAC3BC,SAAS;YACTC,SAAS;YACTC,MAAM;YACNC,SAAS;QACX;QACA,MAAMC,IAAIC,IAAAA,kBAAU,EAACN;QACrBO,OAAOF,GAAGY,aAAa;IACzB;AACF"}