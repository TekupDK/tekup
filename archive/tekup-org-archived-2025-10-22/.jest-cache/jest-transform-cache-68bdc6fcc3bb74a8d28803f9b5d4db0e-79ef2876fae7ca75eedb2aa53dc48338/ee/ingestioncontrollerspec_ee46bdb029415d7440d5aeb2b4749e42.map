{"version":3,"sources":["C:\\Users\\empir\\Tekup-org\\apps\\flow-api\\src\\ingestion\\ingestion.controller.spec.ts"],"sourcesContent":["import { IngestionController } from './ingestion.controller.js';\r\nimport { LeadService } from '../lead/lead.service.js';\r\nimport { MetricsService } from '../metrics/metrics.service.js';\r\n\r\ndescribe('IngestionController', () => {\r\n  const make = () => {\r\n    const metrics = new MetricsService();\r\n    const leadService: Partial<LeadService> = {\r\n      create: jest.fn(async (d: any) => ({ id: 'L1', status: 'NEW', ...d }))\r\n    } as any;\r\n    const controller = new IngestionController(leadService as LeadService, metrics);\r\n    const req: any = { tenantId: 't1' };\r\n    return { controller, metrics, leadService, req };\r\n  };\r\n\r\n  it('ingests form with email', async () => {\r\n    const { controller, req } = make();\r\n    const lead = await controller.ingestForm({ source: 'form', payload: { email: 'a@b.com' } }, req);\r\n    expect(lead.id).toBe('L1');\r\n  });\r\n\r\n  it('rejects invalid payload', async () => {\r\n    const { controller, req } = make();\r\n    await expect(controller.ingestForm({ source: 'form', payload: { foo: 'bar' } } as any, req)).rejects.toBeTruthy();\r\n  });\r\n});\r\n"],"names":["describe","make","metrics","MetricsService","leadService","create","jest","fn","d","id","status","controller","IngestionController","req","tenantId","it","lead","ingestForm","source","payload","email","expect","toBe","foo","rejects","toBeTruthy"],"mappings":";;;;qCAAoC;gCAEL;AAE/BA,SAAS,uBAAuB;IAC9B,MAAMC,OAAO;QACX,MAAMC,UAAU,IAAIC,8BAAc;QAClC,MAAMC,cAAoC;YACxCC,QAAQC,KAAKC,EAAE,CAAC,OAAOC,IAAY,CAAA;oBAAEC,IAAI;oBAAMC,QAAQ;oBAAO,GAAGF,CAAC;gBAAC,CAAA;QACrE;QACA,MAAMG,aAAa,IAAIC,wCAAmB,CAACR,aAA4BF;QACvE,MAAMW,MAAW;YAAEC,UAAU;QAAK;QAClC,OAAO;YAAEH;YAAYT;YAASE;YAAaS;QAAI;IACjD;IAEAE,GAAG,2BAA2B;QAC5B,MAAM,EAAEJ,UAAU,EAAEE,GAAG,EAAE,GAAGZ;QAC5B,MAAMe,OAAO,MAAML,WAAWM,UAAU,CAAC;YAAEC,QAAQ;YAAQC,SAAS;gBAAEC,OAAO;YAAU;QAAE,GAAGP;QAC5FQ,OAAOL,KAAKP,EAAE,EAAEa,IAAI,CAAC;IACvB;IAEAP,GAAG,2BAA2B;QAC5B,MAAM,EAAEJ,UAAU,EAAEE,GAAG,EAAE,GAAGZ;QAC5B,MAAMoB,OAAOV,WAAWM,UAAU,CAAC;YAAEC,QAAQ;YAAQC,SAAS;gBAAEI,KAAK;YAAM;QAAE,GAAUV,MAAMW,OAAO,CAACC,UAAU;IACjH;AACF"}