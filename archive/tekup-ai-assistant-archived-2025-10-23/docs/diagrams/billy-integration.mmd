```mermaid
graph LR
    %% User Request
    User[üë§ User Request<br/>"Create Invoice"] --> Parse[üß† AI Parsing]
    
    %% Step 1: Find Customer
    Parse --> FindCustomer{Customer<br/>Known?}
    FindCustomer -->|No| SearchAPI[üîç Search Billy.dk]
    SearchAPI --> MatchCustomer{Customer<br/>Found?}
    MatchCustomer -->|Yes| ExtractID[Extract Customer ID]
    MatchCustomer -->|No| CreateCustomer[‚ùå Error:<br/>Customer not found]
    FindCustomer -->|Yes| ExtractID
    
    %% Step 2: Calculate Amount
    ExtractID --> CalcAmount[üí∞ Calculate Amount]
    CalcAmount --> GetRate[Get Hourly Rate<br/>Basic: 299 DKK<br/>Deep: 349 DKK<br/>Moving: 349 DKK]
    GetRate --> Multiply[Multiply:<br/>Hours √ó Rate]
    
    %% Step 3: Create Invoice
    Multiply --> BuildRequest[üìù Build Invoice Request]
    BuildRequest --> APICall[üì§ POST /billy/invoices]
    APICall --> BillyAPI[Billy.dk API]
    
    %% API Response
    BillyAPI --> APIResponse{API<br/>Success?}
    APIResponse -->|Yes| InvoiceCreated[‚úÖ Invoice Created]
    APIResponse -->|No| APIError[‚ùå API Error<br/>Retry?]
    APIError --> Retry{Retry<br/>Count < 3?}
    Retry -->|Yes| APICall
    Retry -->|No| Failed[‚ùå Failed]
    
    %% Success Path
    InvoiceCreated --> SendEmail[üìß Send to Customer]
    SendEmail --> FormatResponse[üìã Format Response]
    FormatResponse --> UserResponse[‚úÖ Display to User:<br/>Invoice ID<br/>Amount<br/>Status]
    
    %% Error Paths
    CreateCustomer --> UserResponse
    Failed --> UserResponse
    
    %% Styling
    classDef successStyle fill:#4CAF50,stroke:#333,stroke-width:2px,color:#fff
    classDef errorStyle fill:#F44336,stroke:#333,stroke-width:2px,color:#fff
    classDef processStyle fill:#2196F3,stroke:#333,stroke-width:2px,color:#fff
    classDef decisionStyle fill:#FF9800,stroke:#333,stroke-width:2px,color:#000
    
    class InvoiceCreated,SendEmail,UserResponse successStyle
    class CreateCustomer,APIError,Failed errorStyle
    class Parse,ExtractID,CalcAmount,BuildRequest,APICall,FormatResponse processStyle
    class FindCustomer,MatchCustomer,APIResponse,Retry decisionStyle
```


